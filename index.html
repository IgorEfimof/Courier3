<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор заработка курьера</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --text-color: #333;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --input-bg: #ffffff;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --border-color: #ddd;
            --result-title-color: #2c3e50;
            --result-value-color: #27ae60;
            --summary-bg: #e8f4fc;
            --summary-title-color: #2980b9;
            --warning-color: #e74c3c;
            --highlight-color: #f39c12;
            --section-bg: #f8f9fa;
            --progress-bg: #ecf0f1;
            --progress-fill: #2ecc71;
        }

        .dark-theme {
            --primary-color: #2980b9;
            --secondary-color: #1a252f;
            --text-color: #ecf0f1;
            --bg-color: #1a252f;
            --card-bg: #2c3e50;
            --input-bg: #34495e;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --border-color: #4a6572;
            --result-title-color: #ecf0f1;
            --result-value-color: #2ecc71;
            --summary-bg: #34495e;
            --summary-title-color: #3498db;
            --warning-color: #e74c3c;
            --highlight-color: #f39c12;
            --section-bg: #2c3e50;
            --progress-bg: #34495e;
            --progress-fill: #27ae60;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s, color 0.3s;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.4;
            padding: 15px;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 5px 15px var(--shadow-color);
            overflow: hidden;
        }

        header {
            background: var(--secondary-color);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-content {
            flex: 1;
            text-align: center;
        }

        h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .description {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .theme-toggle-container {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
            background-color: #ccc;
            border-radius: 30px;
            cursor: pointer;
            transition: background-color 0.3s;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
        }

        .theme-toggle.active {
            background-color: #3498db;
        }

        .theme-toggle-handle {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 26px;
            height: 26px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .theme-toggle.active .theme-toggle-handle {
            transform: translateX(30px);
        }

        .theme-toggle-icon {
            font-size: 12px;
            color: #f39c12;
        }

        .theme-toggle-text {
            margin-left: 8px;
            font-size: 0.85rem;
            color: white;
            white-space: nowrap;
        }

        .content {
            display: flex;
            flex-wrap: wrap;
            padding: 15px;
        }

        .input-section, .results-section {
            flex: 1;
            min-width: 300px;
            padding: 15px;
        }

        .input-section {
            background: var(--card-bg);
            border-radius: 8px;
            margin-right: 15px;
        }

        .section-title {
            color: var(--primary-color);
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border-color);
            font-size: 1.2rem;
        }

        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
            align-items: center;
        }

        .form-group {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 16px;
            background-color: var(--input-bg);
            color: var(--text-color);
        }

        .time-inputs {
            display: flex;
            gap: 10px;
        }

        .time-input {
            flex: 1;
        }

        button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 10px;
            transition: background 0.3s;
        }

        button:hover {
            background: var(--secondary-color);
        }

        .compact-results {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 18px;
        }

        .compact-result {
            flex: 1;
            min-width: 120px;
            background: var(--card-bg);
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 5px var(--shadow-color);
            text-align: center;
        }

        .compact-title {
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--result-title-color);
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .compact-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--result-value-color);
            white-space: nowrap;
        }

        .compact-summary {
            display: flex;
            gap: 12px;
            margin-top: 18px;
        }

        .compact-summary-item {
            flex: 1;
            background: var(--summary-bg);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .summary-title {
            font-weight: 700;
            margin-bottom: 6px;
            color: var(--summary-title-color);
            font-size: 0.95rem;
        }

        .summary-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--result-value-color);
        }

        .average-value {
            color: var(--highlight-color);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .info-text {
            font-size: 0.85rem;
            color: var(--primary-color);
            margin-top: 5px;
            text-align: center;
        }

        .section {
            background: var(--section-bg);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .today-summary {
            background: var(--summary-bg);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 18px;
        }

        .today-title {
            font-weight: 700;
            color: var(--summary-title-color);
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 12px;
        }

        .today-amount {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--result-value-color);
            text-align: center;
        }

        .today-details {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
            font-size: 0.95rem;
        }

        .progress-container {
            margin: 15px 0;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .progress-bar {
            height: 10px;
            background-color: var(--progress-bg);
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--progress-fill);
            border-radius: 5px;
            transition: width 0.5s ease-in-out;
        }

        .history-section {
            margin-top: 20px;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .history-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 5px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .history-item:last-child {
            border-bottom: none;
        }

        .history-date {
            font-weight: 600;
        }

        .history-amount {
            color: var(--result-value-color);
            font-weight: 600;
        }
        
        .btn-clear-history {
            background-color: var(--warning-color);
            padding: 8px 12px;
            width: auto;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .input-section {
                margin-right: 0;
                margin-bottom: 15px;
            }
            
            .compact-results, .compact-summary {
                flex-direction: column;
            }
        }
    </style>
</head>
<body class="light-theme">
    <div class="container">
        <header>
            <div class="header-content">
                <h1>Калькулятор заработка курьера</h1>
                <p class="description">Расчет доходов с учетом текущего времени и расходов</p>
            </div>
            <div class="theme-toggle-container">
                <div class="theme-toggle" id="theme-toggle">
                    <div class="theme-toggle-handle">
                        <i class="fas fa-sun theme-toggle-icon"></i>
                    </div>
                </div>
                <span class="theme-toggle-text">Тёмная тема</span>
            </div>
        </header>
        
        <div class="content">
            <div class="input-section">
                <h2 class="section-title">Рабочий день</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="start-time">Начало работы</label>
                        <input type="time" id="start-time" value="09:00">
                    </div>
                    
                    <div class="form-group">
                        <label for="current-time">Текущее время</label>
                        <input type="time" id="current-time">
                    </div>
                    
                    <div class="form-group">
                        <label for="end-time">Конец работы</label>
                        <input type="time" id="end-time" value="18:00">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="orders-count">Количество заказов</label>
                        <input type="number" id="orders-count" min="0" value="21">
                    </div>
                    
                    <div class="form-group">
                        <label for="earned-amount">Заработанная сумма (руб.)</label>
                        <input type="number" id="earned-amount" min="0" step="0.01" value="3519.53">
                    </div>
                </div>
                
                <div class="section">
                    <h2 class="section-title">Расходы</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fuel-per-day">Бензин (л/день)</label>
                            <input type="number" id="fuel-per-day" min="0" step="0.1" value="5">
                        </div>
                        
                        <div class="form-group">
                            <label for="fuel-price">Цена бензина (руб.)</label>
                            <input type="number" id="fuel-price" min="0" step="0.01" value="50">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="other-costs">Другие расходы (руб./день)</label>
                        <input type="number" id="other-costs" min="0" step="0.01" value="200">
                    </div>
                </div>
                
                <div class="section">
                    <h2 class="section-title">График работы</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="work-days-week">Дней в неделю</label>
                            <input type="number" id="work-days-week" min="1" max="7" value="6">
                        </div>
                        
                        <div class="form-group">
                            <label for="work-days-month">Дней в месяц</label>
                            <input type="number" id="work-days-month" min="1" max="31" value="24">
                        </div>
                    </div>
                </div>
                
                <button id="save-day-btn">Сохранить день</button>
                <button id="reset-btn" style="background-color: var(--warning-color);">Сбросить настройки</button>
            </div>
            
            <div class="results-section">
                <div class="today-summary">
                    <div class="today-title">Прогноз на конец дня</div>
                    <div class="today-amount" id="projected-income">0 руб.</div>
                    <div class="today-details">
                        <span id="projected-orders">0 заказов</span>
                        <span id="projected-profit">0 руб. чистыми</span>
                    </div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-label">
                        <span>Прогресс рабочего дня</span>
                        <span id="progress-percent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                    </div>
                </div>
                
                <h2 class="section-title">Прогноз заработка</h2>
                
                <div class="compact-summary">
                    <div class="compact-summary-item">
                        <div class="summary-title">На конец дня</div>
                        <div class="summary-value" id="daily-projection">0 руб.</div>
                    </div>
                    
                    <div class="compact-summary-item">
                        <div class="summary-title">На конец недели</div>
                        <div class="summary-value" id="weekly-projection">0 руб.</div>
                    </div>
                    
                    <div class="compact-summary-item">
                        <div class="summary-title">На конец месяца</div>
                        <div class="summary-value" id="monthly-projection">0 руб.</div>
                    </div>
                </div>
                
                <h2 class="section-title">Текущие результаты</h2>
                
                <div class="compact-results">
                    <div class="compact-result">
                        <div class="compact-title">Заказов</div>
                        <div class="compact-value" id="current-orders">0</div>
                    </div>
                    
                    <div class="compact-result">
                        <div class="compact-title">Доход</div>
                        <div class="compact-value" id="current-income">0 руб.</div>
                    </div>
                    
                    <div class="compact-result">
                        <div class="compact-title">Расходы</div>
                        <div class="compact-value" id="current-costs">0 руб.</div>
                    </div>
                    
                    <div class="compact-result">
                        <div class="compact-title">Чистый доход</div>
                        <div class="compact-value" id="current-profit">0 руб.</div>
                    </div>
                </div>
                
                <div class="history-section">
                    <div class="history-header">
                        <h2 class="section-title">История дней</h2>
                        <button id="clear-history-btn" class="btn-clear-history">Очистить историю</button>
                    </div>
                    <div class="history-list" id="history-list">
                        <!-- История будет добавляться динамически -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Элементы DOM
            const resetBtn = document.getElementById('reset-btn');
            const saveDayBtn = document.getElementById('save-day-btn');
            const clearHistoryBtn = document.getElementById('clear-history-btn');
            const themeToggle = document.getElementById('theme-toggle');
            
            // Параметры рабочего дня
            const startTimeInput = document.getElementById('start-time');
            const currentTimeInput = document.getElementById('current-time');
            const endTimeInput = document.getElementById('end-time');
            const ordersCountInput = document.getElementById('orders-count');
            const earnedAmountInput = document.getElementById('earned-amount');
            
            // Расходы
            const fuelPerDayInput = document.getElementById('fuel-per-day');
            const fuelPriceInput = document.getElementById('fuel-price');
            const otherCostsInput = document.getElementById('other-costs');
            
            // График работы
            const workDaysWeekInput = document.getElementById('work-days-week');
            const workDaysMonthInput = document.getElementById('work-days-month');
            
            // Результаты
            const projectedIncomeElement = document.getElementById('projected-income');
            const projectedOrdersElement = document.getElementById('projected-orders');
            const projectedProfitElement = document.getElementById('projected-profit');
            const progressPercentElement = document.getElementById('progress-percent');
            const progressFillElement = document.getElementById('progress-fill');
            const dailyProjectionElement = document.getElementById('daily-projection');
            const weeklyProjectionElement = document.getElementById('weekly-projection');
            const monthlyProjectionElement = document.getElementById('monthly-projection');
            const currentOrdersElement = document.getElementById('current-orders');
            const currentIncomeElement = document.getElementById('current-income');
            const currentCostsElement = document.getElementById('current-costs');
            const currentProfitElement = document.getElementById('current-profit');
            const historyListElement = document.getElementById('history-list');
            
            // Установка текущего времени по умолчанию
            function setCurrentTime() {
                const now = new Date();
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                currentTimeInput.value = `${hours}:${minutes}`;
            }
            
            setCurrentTime();
            
            // Сохранение данных в localStorage
            function saveData() {
                const data = {
                    startTime: startTimeInput.value,
                    endTime: endTimeInput.value,
                    ordersCount: ordersCountInput.value,
                    earnedAmount: earnedAmountInput.value,
                    fuelPerDay: fuelPerDayInput.value,
                    fuelPrice: fuelPriceInput.value,
                    otherCosts: otherCostsInput.value,
                    workDaysWeek: workDaysWeekInput.value,
                    workDaysMonth: workDaysMonthInput.value
                };
                
                localStorage.setItem('courierCalculatorData', JSON.stringify(data));
            }
            
            // Загрузка данных из localStorage
            function loadData() {
                const savedData = localStorage.getItem('courierCalculatorData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    
                    startTimeInput.value = data.startTime || '09:00';
                    endTimeInput.value = data.endTime || '18:00';
                    ordersCountInput.value = data.ordersCount || '21';
                    earnedAmountInput.value = data.earnedAmount || '3519.53';
                    fuelPerDayInput.value = data.fuelPerDay || '5';
                    fuelPriceInput.value = data.fuelPrice || '50';
                    otherCostsInput.value = data.otherCosts || '200';
                    workDaysWeekInput.value = data.workDaysWeek || '6';
                    workDaysMonthInput.value = data.workDaysMonth || '24';
                    
                    calculate();
                }
            }
            
            // Загрузка истории из localStorage
            function loadHistory() {
                const savedHistory = localStorage.getItem('courierHistory');
                if (savedHistory) {
                    const history = JSON.parse(savedHistory);
                    updateHistoryList(history);
                }
            }
            
            // Обновление списка истории
            function updateHistoryList(history) {
                historyListElement.innerHTML = '';
                
                if (history.length === 0) {
                    historyListElement.innerHTML = '<div class="history-item">Нет данных</div>';
                    return;
                }
                
                history.slice().reverse().forEach(item => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    
                    const dateElement = document.createElement('span');
                    dateElement.className = 'history-date';
                    dateElement.textContent = item.date;
                    
                    const amountElement = document.createElement('span');
                    amountElement.className = 'history-amount';
                    amountElement.textContent = formatNumber(item.amount) + ' руб.';
                    
                    historyItem.appendChild(dateElement);
                    historyItem.appendChild(amountElement);
                    historyListElement.appendChild(historyItem);
                });
            }
            
            // Очистка истории
            function clearHistory() {
                if (confirm('Вы уверены, что хотите очистить всю историю? Это действие нельзя отменить.')) {
                    localStorage.removeItem('courierHistory');
                    updateHistoryList([]);
                }
            }
            
            // Сохранение дня в историю
            function saveDay() {
                const date = new Date().toLocaleDateString('ru-RU');
                const amount = parseFloat(earnedAmountInput.value);
                
                let history = [];
                const savedHistory = localStorage.getItem('courierHistory');
                if (savedHistory) {
                    history = JSON.parse(savedHistory);
                }
                
                // Проверяем, есть ли уже запись за сегодня
                const todayIndex = history.findIndex(item => item.date === date);
                if (todayIndex !== -1) {
                    if (!confirm('Запись за сегодня уже существует. Перезаписать?')) {
                        return;
                    }
                    history[todayIndex].amount = amount;
                } else {
                    history.push({ date, amount });
                }
                
                localStorage.setItem('courierHistory', JSON.stringify(history));
                updateHistoryList(history);
                
                alert('Данные за день сохранены!');
            }
            
            // Сброс данных к значениям по умолчанию
            function resetData() {
                if (confirm('Вы уверены, что хотите сбросить все настройки к значениям по умолчанию?')) {
                    startTimeInput.value = '09:00';
                    endTimeInput.value = '18:00';
                    ordersCountInput.value = '21';
                    earnedAmountInput.value = '3519.53';
                    fuelPerDayInput.value = '5';
                    fuelPriceInput.value = '50';
                    otherCostsInput.value = '200';
                    workDaysWeekInput.value = '6';
                    workDaysMonthInput.value = '24';
                    setCurrentTime();
                    
                    localStorage.removeItem('courierCalculatorData');
                    calculate();
                }
            }
            
            // Преобразование времени в минуты
            function timeToMinutes(timeStr) {
                const [hours, minutes] = timeStr.split(':').map(Number);
                return hours * 60 + minutes;
            }
            
            // Форматирование числа с разделителями
            function formatNumber(number) {
                return new Intl.NumberFormat('ru-RU', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).format(number);
            }
            
            // Расчет показателей
            function calculate() {
                // Получаем значения из полей ввода
                const startTime = startTimeInput.value;
                const currentTime = currentTimeInput.value;
                const endTime = endTimeInput.value;
                const ordersCount = parseFloat(ordersCountInput.value) || 0;
                const earnedAmount = parseFloat(earnedAmountInput.value) || 0;
                
                const fuelPerDay = parseFloat(fuelPerDayInput.value) || 0;
                const fuelPrice = parseFloat(fuelPriceInput.value) || 0;
                const otherCosts = parseFloat(otherCostsInput.value) || 0;
                
                const workDaysWeek = parseFloat(workDaysWeekInput.value) || 0;
                const workDaysMonth = parseFloat(workDaysMonthInput.value) || 0;
                
                // Рассчитываем продолжительность рабочего дня и прошедшее время
                const startMinutes = timeToMinutes(startTime);
                const currentMinutes = timeToMinutes(currentTime);
                const endMinutes = timeToMinutes(endTime);
                
                let totalDayMinutes = endMinutes - startMinutes;
                let passedMinutes = currentMinutes - startMinutes;
                
                // Обработка случая, когда рабочий день переходит через полночь
                if (totalDayMinutes < 0) {
                    totalDayMinutes += 24 * 60;
                }
                if (passedMinutes < 0) {
                    passedMinutes += 24 * 60;
                }
                
                // Проверяем, чтобы значения были корректными
                if (totalDayMinutes <= 0 || passedMinutes < 0) {
                    alert('Некорректное время работы! Проверьте время начала и окончания.');
                    return;
                }
                
                // Рассчитываем прогресс дня в процентах
                const progressPercent = Math.min(100, Math.max(0, (passedMinutes / totalDayMinutes) * 100));
                progressPercentElement.textContent = `${progressPercent.toFixed(1)}%`;
                progressFillElement.style.width = `${progressPercent}%`;
                
                // Рассчитываем текущие показатели
                const dailyFuelCost = fuelPerDay * fuelPrice;
                const dailyCosts = dailyFuelCost + otherCosts;
                const currentCostsValue = dailyCosts * (progressPercent / 100);
                const currentProfit = earnedAmount - currentCostsValue;
                
                // Рассчитываем прогнозируемые показатели на конец дня
                let projectedOrders = ordersCount;
                let projectedIncome = earnedAmount;
                
                if (progressPercent > 0 && progressPercent < 100) {
                    projectedOrders = ordersCount * (100 / progressPercent);
                    projectedIncome = earnedAmount * (100 / progressPercent);
                }
                
                const projectedDailyCosts = dailyCosts;
                const projectedProfit = projectedIncome - projectedDailyCosts;
                
                // Рассчитываем прогноз на неделю и месяц
                const weeklyProjection = projectedProfit * workDaysWeek;
                const monthlyProjection = projectedProfit * workDaysMonth;
                
                // Обновляем результаты на странице
                currentOrdersElement.textContent = ordersCount;
                currentIncomeElement.textContent = `${formatNumber(earnedAmount)} руб.`;
                currentCostsElement.textContent = `${formatNumber(currentCostsValue)} руб.`;
                currentProfitElement.textContent = `${formatNumber(currentProfit)} руб.`;
                
                projectedIncomeElement.textContent = `${formatNumber(projectedIncome)} руб.`;
                projectedOrdersElement.textContent = `${Math.round(projectedOrders)} заказов`;
                projectedProfitElement.textContent = `${formatNumber(projectedProfit)} руб. чистыми`;
                
                dailyProjectionElement.textContent = `${formatNumber(projectedProfit)} руб.`;
                weeklyProjectionElement.textContent = `${formatNumber(weeklyProjection)} руб.`;
                monthlyProjectionElement.textContent = `${formatNumber(monthlyProjection)} руб.`;
                
                // Сохраняем данные
                saveData();
            }
            
            // Обработчики событий
            startTimeInput.addEventListener('change', calculate);
            currentTimeInput.addEventListener('change', calculate);
            endTimeInput.addEventListener('change', calculate);
            ordersCountInput.addEventListener('input', calculate);
            earnedAmountInput.addEventListener('input', calculate);
            fuelPerDayInput.addEventListener('input', calculate);
            fuelPriceInput.addEventListener('input', calculate);
            otherCostsInput.addEventListener('input', calculate);
            workDaysWeekInput.addEventListener('input', calculate);
            workDaysMonthInput.addEventListener('input', calculate);
            
            resetBtn.addEventListener('click', resetData);
            saveDayBtn.addEventListener('click', saveDay);
            clearHistoryBtn.addEventListener('click', clearHistory);
            
            // Переключение темы
            function toggleTheme() {
                const isDark = document.body.classList.toggle('dark-theme');
                document.body.classList.toggle('light-theme', !isDark);
                themeToggle.classList.toggle('active', isDark);
                
                // Обновляем иконку в зависимости от темы
                const icon = themeToggle.querySelector('.theme-toggle-icon');
                if (isDark) {
                    icon.className = 'fas fa-moon theme-toggle-icon';
                    localStorage.setItem('theme', 'dark');
                } else {
                    icon.className = 'fas fa-sun theme-toggle-icon';
                    localStorage.setItem('theme', 'light');
                }
            }
            
            themeToggle.addEventListener('click', toggleTheme);
            
            // Проверка сохраненной темы
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
                document.body.classList.remove('light-theme');
                themeToggle.classList.add('active');
                
                // Обновляем иконку
                const icon = themeToggle.querySelector('.theme-toggle-icon');
                icon.className = 'fas fa-moon theme-toggle-icon';
            }
            
            // Загрузка сохраненных данных и первоначальный расчет
            loadData();
            loadHistory();
            calculate();
            
            // Обновление текущего времени каждую минуту
            setInterval(setCurrentTime, 60000);
            setInterval(calculate, 30000); // Пересчет каждые 30 секунд
        });
    </script>
</body>
</html>
